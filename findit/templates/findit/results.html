{% extends "findit/base.html" %}
{% load findit_tags %}
{% block extra_css %}
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" type="text/css">
{% endblock%}
{% block javascripts%}
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}js/helpers.js"></script>
	<!--<script type="text/javascript" src="{{ MEDIA_URL }}js/pure_min.js"></script>-->
	<!--<script type="text/javascript" src="{{ MEDIA_URL }}js/exportCitation.js"></script>-->
{% endblock %}

{% block content %}


<div id="findit-core">
	{% if held and etext %}
	<div id="primary-article-link">
				<h2><a href="{{ article_url }}"> Full text from {{ article_label|lower }}</a></h2>
	</div>
	{% endif %}
	<div id="citation">
		<! -- show options for locating article if result not found -->
		{% if not found %}
			<div id="not-found-info">
				<h3>{{ message }}</h3>
				<ul>
					{% if not citation.doi %}
						{% if not citation.pmid %}
						<li><a href="{{ refiner_url }}">Try adding more information about the article.</a></li>
						{% endif %}
					{% endif %}
					<li><a href="{{ ill_url|safe }}">Request from another library.</a></li>
					{% if mendeley_url %}
						<li id="mendeley-url">Find more information about the resource on <a href="{{ mendeley_url }}">Mendeley</a>.</li>
					{% endif %}
					<li>Ask a librarian.</li>
				</ul>
			</div>
		{% endif %}
		{% if etext %}
			<div class="title">{{ citation.title }}</div>
		{% else %}
			<div class="title">{{ citation.title }}</div>
		{% endif %}
		<div class="creator"> {{ creator }} </div>
		<div class="source"> {{ citation.source }}</div>
		<div class="source-details">
			{% if citation.volume %}
			 	<span class="vol">Vol. {{ citation.volume }}. </span>
			{% endif %}
			{% if citation.issue %}
				<span class="issue">Issue {{ citation.issue }}.</span>
			{% endif %}
			{% if citation.spage %}
				<span class="page">Page {{ citation.spage }}.  </span>
			{% endif %}
			{% if citation.date %}
				<span class="date">{{ citation.date }}</span>
			{% endif %}
		</div>
		<div class="source-ids">
			{% if citation.issn %}
				ISSNs:
				{% for type, issn in citation.issn.items %}
					<span class="issn">{{ issn }}</span>
				{% endfor %}
			{% endif %}
			{% if citation.pmid %}
				<span id="pmid">Pubmed ID: {{ citation.pmid }}</span>
			{% endif %}
			{% if citation.doi %}
				<span id="doi">DOI: {{ citation.doi }}</span>
			{% endif %}
		</div>
		{% if citation.doi %}
			<div class="permalink"><a href="{{ BASE_URL }}?id={{ citation.doi }}">Permanent link to this page</a></div>
		{% else %}
			{%if citation.pmid %}
				<div class="permalink"><a href="{{ BASE_URL }}?pmid={{ citation.pmid }}">Permanent link to this page</a></div>
			{% endif %}
		{% endif %}
		{% if mendeley_url %}
			<div class="permalink"><a href="{{ mendeley_url }}">Mendeley</a></div>
		{% endif %}
		{% if citation and format %}
			{% coins_span citation format %}
		{% endif %}
	</div>
	
	{% comment %}
	<!-- exports/email -->
	<span class="SSALItemEmail"> 
        <a onclick="exportArrowLinkSet(this.id); return false;" href="about:blank" class="SSALExportLink" id="emailCitation">Email <img alt="Show options" class="SSALArrowLinkImage" src="{{ MEDIA_URL }}/images/down_arrow.gif" /> 
            <img style="display: none" alt="Show options" class="SSALArrowLinkImage" src="{{ MEDIA_URL }}/images/up_arrow.gif" /> 
		</a> 
    </span>
    <span class="SSALItemExport"> 
        <a onclick="exportArrowLinkSet(this.id); return false;" href="about:blank" class="SSALExportLink" id="exportCitation">Export/Save <img alt="Show options" class="SSALArrowLinkImage" src="{{ MEDIA_URL }}/images/down_arrow.gif" /> 
              <img style="display: none" alt="Show options" class="SSALArrowLinkImage" src="{{ MEDIA_URL }}/images/up_arrow.gif" /> 
    	</a> 
    </span> 
    {% endcomment %}
	{% if held %}
		{% if etext %}
			<div id="article-link">
				<div id="article-url"><a href="{{ article_url }}">{{ article_label }}</a>
					<span id="details">Show details</span>
				</div>
			</div>
			<!-- hide div for holding details -->
			<div id="holdings-details" class="hidden">
		{% else %}
			<!-- display holding details when no direct link to article. -->
			<div id="holdings-details">
		{% endif %}
			<!-- proceed with details in either case.  --->
			<h5 class="results">Holdings</h4>
					<table id="holdings">
					<tr class="table-header">
					  <td class="links" colspan="2">Links</td>
					  <td>Resource</td>
					  <td>Coverage</td>
					</tr>
					<!-- ss data -->
					{% for lset in links %}
						<tr>
						  <td class="links" colspan="2">
						  	{% if lset.url.article %}
						  		<a href="{{ lset.url.article }}">Article</a>
						  	{% endif %}
						  	{% if lset.url.journal %}
						  		<a href="{{ lset.url.journal }}">Journal</a>
						  	{% endif %}
						  </td>
						  <td>{{ lset.holdingData.databaseName }}</td>
						  <td>{{ lset.holdingData.startDate }} - {% if lset.holdingData.endDate %} {{ lset.holdingData.endDate }} {% else %} present {% endif %}</td>
						</tr>
					{% endfor %}
					</table>
			</div>
		{% endif %}
	
	
</div>

<!--- call rapid print for now if now article found -->
{% if search_print %}
		<div id="print-holdings">
			<h5 class="print results">Print</h5>
			<ul class="results print">
			</ul>
			<div id="progressbar"></div>
		</div>
{% endif %}

<h5 class="abstract results">Abstract</h5>
<div id="abstract">

</div>


{% if data_source %}
	<div id="data-sources">
		Data provided by: 
		<ul class="data-sources">
		{% for source in data_source %}
			<li>{{ source }}</li>
		{% endfor %}
		</ul>
	</div>
{% endif %}
<div id="query-time">Query time: {{ query_time }}</div>


{% if DEBUG %}
<h5 class="results">Debug urls</h5>
<p>These urls show the raw responses from various services.</p>
<div id="debug_urls">
	<ul>
		{% for durl in debug_urls %}
			<li><a href="{{ durl.url }}">{{ durl.label|title}}</a></li>
		{% endfor %}			
	</ul>
</div>
{% endif %}

{% endblock %}

{% block extra_content %}
<h5 class="related results">Related research</h5>
<div id="related" class="related">
	<ul>
	</ul>
</div>

<div id="feed">
	<h5 class="feed results">Recent articles from this publication</h5>
	<ul>
	</ul>
</div>
{% endblock %}

{% block footer_javascripts %}
<script>
	$(document).ready(function() {
		var base_url = "{{ BASE_URL }}";
		var cover_url = base_url + 'images/';
		{% if TEST_ENV %}
		window.logging = true;
		{% else %}
		window.logging = false;
		{% endif %}
		//get_print(base_url);
		//get_local_print(base_url);
		//function to show and hide holding details based on article match
		holding_details();
		cover_runner(cover_url);
		extras_runner(base_url, debug);
		//Call to find print if etext not available.
		{% if search_print %}
		print_runner(base_url, debug);
		{% endif %}
		//var url_spot = $('#direct_article_url');
		//if (url_spot) {
		//	alert($('#direct_article_url').text());
		//};
		//collapse long lists from: http://www.pewpewlaser.com/articles/jquery-hide-extra-list-items
		
	});
</script>


{% endblock %}
